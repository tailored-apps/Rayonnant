@inherits LayoutComponentBase
@inject Rayonnant.Shell.Services.ModuleLoader ModuleLoader

<MudThemeProvider Theme="_theme" IsDarkMode="true" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="4" Dense="true">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start"
                       OnClick="@ToggleLeftDrawer" />
        <MudText Typo="Typo.h6" Class="ml-2">Rayonnant</MudText>
        <MudSpacer />
        <MudTextField T="string" Placeholder="Search..." Variant="Variant.Outlined" Margin="Margin.Dense"
                      Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search"
                      Class="mx-4" Style="max-width: 400px;" />
        <MudSpacer />
        <MudIconButton Icon="@Icons.Material.Filled.AccountCircle" Color="Color.Inherit" />
        <MudIconButton Icon="@Icons.Material.Filled.ViewSidebar" Color="Color.Inherit"
                       OnClick="@ToggleRightDrawer" />
        <MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Inherit" Href="/settings" />
    </MudAppBar>

    <MudDrawer @bind-Open="_leftDrawerOpen" ClipMode="DrawerClipMode.Docked"
               Variant="@DrawerVariant.Mini" Elevation="2" OpenMiniOnHover="true">
        <MudNavMenu>
            @foreach (var item in ModuleLoader.NavItems.OrderBy(n => n.Order))
            {
                <MudNavLink Href="@item.Href" Icon="@item.Icon" Match="NavLinkMatch.All">
                    @item.Title
                </MudNavLink>
            }
            <MudNavLink Href="/settings" Icon="@Icons.Material.Filled.Settings">Settings</MudNavLink>
        </MudNavMenu>
    </MudDrawer>

    <MudDrawer @bind-Open="_rightDrawerOpen" Anchor="Anchor.End" Elevation="2"
               ClipMode="DrawerClipMode.Docked" Width="300px">
        <MudDrawerHeader>
            <MudText Typo="Typo.h6">Quick Info</MudText>
        </MudDrawerHeader>
        <MudContainer Class="pa-2">
            <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="mb-2">System</MudText>
            <MudSimpleTable Dense="true" Hover="true" Elevation="0" Style="font-size:0.8rem;">
                <tbody>
                    <tr><td>Uptime</td><td><b>14d 6h</b></td></tr>
                    <tr><td>Modules</td><td><b>@ModuleLoader.NavItems.Count()</b> loaded</td></tr>
                    <tr><td>.NET</td><td><b>10.0</b></td></tr>
                    <tr><td>Environment</td><td><MudChip T="string" Size="Size.Small" Color="Color.Warning">Dev</MudChip></td></tr>
                </tbody>
            </MudSimpleTable>

            <MudDivider Class="my-3" />
            <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="mb-2">Notifications</MudText>
            <MudAlert Severity="Severity.Info" Dense="true" NoIcon="true" Class="mb-1" Style="font-size:0.75rem;">3 pending tasks</MudAlert>
            <MudAlert Severity="Severity.Warning" Dense="true" NoIcon="true" Class="mb-1" Style="font-size:0.75rem;">1 alert active</MudAlert>
            <MudAlert Severity="Severity.Success" Dense="true" NoIcon="true" Class="mb-1" Style="font-size:0.75rem;">All services OK</MudAlert>

            <MudDivider Class="my-3" />
            <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="mb-2">Help</MudText>
            <MudLink Typo="Typo.caption" Href="#" Class="d-block mb-1">Documentation</MudLink>
            <MudLink Typo="Typo.caption" Href="#" Class="d-block mb-1">Keyboard Shortcuts</MudLink>
            <MudLink Typo="Typo.caption" Href="#" Class="d-block">Report Issue</MudLink>
        </MudContainer>
    </MudDrawer>

    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.False" Class="pa-6" Style="min-height: calc(100vh - 120px);">
            @Body
        </MudContainer>
        <MudPaper Elevation="0" Class="d-flex align-center px-4 py-1"
                  Style="background-color: var(--mud-palette-surface); border-top: 1px solid var(--mud-palette-lines-default);">
            <MudText Typo="Typo.caption" Color="Color.Tertiary">Rayonnant v2.0</MudText>
            <MudSpacer />
            <MudText Typo="Typo.caption" Color="Color.Tertiary">Ready</MudText>
        </MudPaper>
    </MudMainContent>
</MudLayout>

@code {
    private bool _leftDrawerOpen = true;
    private bool _rightDrawerOpen = false;

    private readonly MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight(),
        PaletteDark = new PaletteDark
        {
            Primary = "#7c4dff",
            Secondary = "#448aff",
            AppbarBackground = "#1e1e2e",
            Surface = "#1e1e2e",
            Background = "#11111b",
            DrawerBackground = "#181825",
            DrawerText = "#cdd6f4",
            TextPrimary = "#cdd6f4",
            TextSecondary = "#a6adc8",
        },
        Typography = new Typography
        {
            Default = new DefaultTypography { FontFamily = ["Roboto", "Helvetica", "Arial", "sans-serif"] }
        }
    };

    private void ToggleLeftDrawer() => _leftDrawerOpen = !_leftDrawerOpen;
    private void ToggleRightDrawer() => _rightDrawerOpen = !_rightDrawerOpen;
}
